<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>JSONRPC Framework: Example</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="index.html">Ali's JSON-RPC Framework documentation</a>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="Example">Example </a></h1><h2><a class="anchor" id="Example_TestClass">
Test class: a demo of using the JSONRPC Framework</a></h2>
<div class="fragment"><pre class="fragment"><span class="preprocessor">     #import &quot;<a class="code" href="_j_s_o_n_r_p_c_8h.html" title="Common header that include other headers of the framework. Contains useful macros...">JSONRPC.h</a>&quot;</span>
     <span class="keyword">@interface </span>TestClass : NSObject &lt;JSONRPCErrorHandler&gt;
     -(void)testIt;
     <span class="keyword">@end</span>
</pre></div><div class="fragment"><pre class="fragment"><span class="preprocessor">     #import &quot;TestClass.h&quot;</span>
<span class="preprocessor">     #import &quot;Person.h&quot;</span>

     <span class="keyword">@implementation </span>TestClass
     -(void)testIt
     {
       <a class="code" href="interface_j_s_o_n_r_p_c_service.html" title="The class representing a JSON-RPC WebService (identified by an URL to call methods...">JSONRPCService</a>* service = [[[<a class="code" href="interface_j_s_o_n_r_p_c_service.html" title="The class representing a JSON-RPC WebService (identified by an URL to call methods...">JSONRPCService</a> alloc] initWithURL:kServiceURL] autorelease];

       [[service <a class="code" href="interface_j_s_o_n_r_p_c_service.html#ad5c6e7abfbbdfc73e32f7461677965b5" title="Commodity method to call a JSON-RPC method on the WebService.">callMethodWithNameAndParams</a>:@&quot;getUserDetails&quot;,@&quot;user1234&quot;,nil]
        <a class="code" href="interface_j_s_o_n_r_p_c_response_handler.html#a305c8ac7ca06265ed673ef97d0b12b1a" title="set both the delegate, the callback and the resultClass at once.">setDelegate</a>:self <a class="code" href="interface_j_s_o_n_r_p_c_response_handler.html#a305c8ac7ca06265ed673ef97d0b12b1a" title="set both the delegate, the callback and the resultClass at once.">callback</a>:@selector(<a class="code" href="interface_j_s_o_n_r_p_c_response_handler.html#a305c8ac7ca06265ed673ef97d0b12b1a" title="set both the delegate, the callback and the resultClass at once.">methodCall</a>:<a class="code" href="interface_j_s_o_n_r_p_c_response_handler.html#a305c8ac7ca06265ed673ef97d0b12b1a" title="set both the delegate, the callback and the resultClass at once.">didReturnUser</a>:<a class="code" href="interface_j_s_o_n_r_p_c_response_handler.html#a305c8ac7ca06265ed673ef97d0b12b1a" title="set both the delegate, the callback and the resultClass at once.">error</a>:) <a class="code" href="interface_j_s_o_n_r_p_c_response_handler.html#a305c8ac7ca06265ed673ef97d0b12b1a" title="set both the delegate, the callback and the resultClass at once.">resultClass</a>:[Person class]];
       <span class="comment">// will convert the returned JSON into a Person object (providing that the class Person respond to -initWithJson, this is the case below)</span>
     }

     -(void)methodCall:(<a class="code" href="interface_j_s_o_n_r_p_c_method_call.html" title="This class represent a method call on a JSON-RPC WebService.">JSONRPCMethodCall</a>*)meth didReturnUser:(Person*)p error:(NSError*)err
     {
       <span class="comment">// We will effectively receive a &quot;Person*&quot; object (and not a JSON object like a NSDictionary) in the parameter p</span>
       <span class="comment">// because we asked to convert the result using [Person class] in -testIt</span>

       NSLog(<span class="stringliteral">@&quot;Received person: %@&quot;</span>,p);
       <span class="keywordflow">if</span> (error) NSLog(<span class="stringliteral">@&quot;error in method call: %@&quot;</span>,err);
     }

     -(BOOL)methodCall:(<a class="code" href="interface_j_s_o_n_r_p_c_method_call.html" title="This class represent a method call on a JSON-RPC WebService.">JSONRPCMethodCall</a>*)meth didFailWithError:(NSError*)err
     {
       <span class="comment">// handle the NSError (network error / no connection, etc.)</span>
       <span class="keywordflow">return</span> NO; <span class="comment">// don&#39;t call methodCall:didFailWithError: on the JSONRPCService&#39;s delegate.</span>
     }
     <span class="keyword">@end</span>
</pre></div><h2><a class="anchor" id="Example_Person">
Person class: to represent in ObjC the persons returned by the JSONRPC WebService</a></h2>
<p>Used in TestClass as the result is converted into a Person object ("... resultClass:[Person class]")</p>
<div class="fragment"><pre class="fragment">     <span class="keyword">@interface </span>Person : NSObject {
       NSString* firstName;
       NSString* lastName;
     }
     -(void)initWithJson:(<span class="keywordtype">id</span>)jsonObj;
     @property(nonatomic,retain) NSString* firstName;
     @property(nonatomic,retain) NSString* lastName;
     @end
</pre></div><div class="fragment"><pre class="fragment"><span class="preprocessor">     #import &quot;Person.h&quot;</span>

     <span class="keyword">@implementation </span>Person
     <span class="keyword">@synthesize</span> firstName,lastName;
     -(id)initWithJson:(<span class="keywordtype">id</span>)jsonObj
     {
        <span class="keywordflow">if</span> (<span class="keyword">self</span> = [super init]) {
          <span class="keyword">self</span>.firstName = [jsonObj objectForKey:@&quot;firstname&quot;];
          <span class="keyword">self</span>.lastName = [jsonObj objectForKey:@&quot;lastname&quot;];
        }
        <span class="keywordflow">return</span> <span class="keyword">self</span>;
     }
     -(NSString*)description { <span class="keywordflow">return</span> [NSString stringWithFormat:@&quot;&lt;Person %@ %@&gt;&quot;,firstName,lastName]; }
     -(void)dealloc
     {
       [firstName release];
       [lastName release];
       [<span class="keyword">super</span> dealloc];
     }
     <span class="keyword">@end</span>
</pre></div> </div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Thu May 27 23:03:40 2010 for JSONRPC Framework by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
