<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>JSONRPC Framework: Converting the JSON response to a custom class</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="index.html">Ali's JSON-RPC Framework documentation</a>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="OverviewResultConversion">Converting the JSON response to a custom class </a></h1><p>You can make the JSON response of your remote method call be converted into the class of your choice. This is very useful to manipulate instances of your custom classes instead of only use NSDictionaries</p>
<p>To make this possible, the class you want the JSON object to be converted to should respond to initWithJson: to be initialized using the JSON object. (see <a class="el" href="_overview_result_conversion.html#ResultConversionExample1">Simple example</a>) </p>
<dl class="note"><dt><b>Note:</b></dt><dd>Optionally, this class may also respond to -jsonProxy to be converted back to a JSON object if needed later (see SBJSON documentation)</dd></dl>
<p>If the JSON object returned by the WebService is an array, the convertion from the JSON object to the given Class will be done on the objects in this array, and not on the array itself. This way, an array of objects representing e.g. a person can be converted into an NSArray of Person objects.</p>
<p>For more complex objects, you can call initWithJson in the initWithJson method itself, and also use arrayWithJson:itemsClass: method of the NSArray(JSON) category (<a class="el" href="_j_s_o_n_r_p_c___extensions_8h_source.html">JSONRPC_Extensions.h</a>). See <a class="el" href="_overview_result_conversion.html#ResultConversionExample2">More complex example</a></p>
<hr/>
 <h2><a class="anchor" id="ResultConversionExample1">
Simple example</a></h2>
<p>As an example, to handle JSON objects representing a person with fields "firstname" and "lastname": </p>
<div class="fragment"><pre class="fragment"> {
    firstname: <span class="stringliteral">&quot;John&quot;</span>,
    lastname: <span class="stringliteral">&quot;Doe&quot;</span>
 }
</pre></div><p> Then you can define an "Person" Objective-C class (to convert those JSON objects) like this: </p>
<div class="fragment"><pre class="fragment"> <span class="keyword">@interface </span>Person : NSObject {
   NSString* firstName;
   NSString* lastName;
 }
 @property(nonatomic, retain) NSString* firstName;
 @property(nonatomic, retain) NSString* lastName;
 -(<span class="keywordtype">id</span>)initWithJson:(NSDictionary*)json;
</pre></div> <div class="fragment"><pre class="fragment"> <span class="keyword">@implementation </span>Perso
 <span class="keyword">@synthesize</span> firstName, lastName;
 -(id)initWithJson:(NSDictionary*)json {
   <span class="keywordflow">if</span> (<span class="keyword">self</span> = [super init]) {
     <span class="keyword">self</span>.firstName = [json objectForKey:@&quot;firstname&quot;];
     <span class="keyword">self</span>.lastName = [json objectForKey:@&quot;lastname&quot;];
   }
   <span class="keywordflow">return</span> <span class="keyword">self</span>;
 }
 -(void)dealloc {
   [firstName release];
   [lastName release];
   [<span class="keyword">super</span> dealloc];
 }
</pre></div><p>Then, if you have a JSON-RPC method that returns a JSON representation of a person as a result, you can call it this way: </p>
<div class="fragment"><pre class="fragment"> [[service <a class="code" href="interface_j_s_o_n_r_p_c_service.html#aeb4b174af586824d86ae4c438cbb1971" title="Commodity method to call a JSON-RPC method on the WebService.">callMethodWithName</a>:@&quot;getAPerson&quot; <a class="code" href="interface_j_s_o_n_r_p_c_service.html#aeb4b174af586824d86ae4c438cbb1971" title="Commodity method to call a JSON-RPC method on the WebService.">parameters</a>:nil] setResultClass:[Person class]];
</pre></div><p> And when the delegate method will be called, a Person instance, constructed from the returned JSON, will be passed as the second parameter: </p>
<div class="fragment"><pre class="fragment"> -(void)methodCall:(<a class="code" href="interface_j_s_o_n_r_p_c_method_call.html" title="This class represent a method call on a JSON-RPC WebService.">JSONRPCMethodCall</a>*)mc didReturn:(Person*)person error:(NSError*)error {
   <span class="comment">// handle the Person object here</span>
 }
</pre></div><hr/>
<h2><a class="anchor" id="ResultConversionExample2">
More complex example</a></h2>
<p>If the JSON object returned by the WebService is more complex, you can call initWithJson (on other classes) from your initWithJson implementation and even use the -[NSArray initWithJson:itemsClass:] or +[NSArray arrayWithJson:itemsClass:] methods of the NSArray category to build complex instances.</p>
<p>For example, image your WebService also return a JSON object representing a family, like this: </p>
<div class="fragment"><pre class="fragment"> {
   father: { firstname:<span class="stringliteral">&quot;John&quot;</span>, lastname:<span class="stringliteral">&quot;Doe&quot;</span> },
   mother: { firstname:<span class="stringliteral">&quot;Jane&quot;</span>, lastname:<span class="stringliteral">&quot;Doe&quot;</span> },
   children: [ { firstname:&quot;John Jr&quot;, lastname:&quot;Doe&quot; }, { firstname:&quot;Jane Jr&quot;, lastname:&quot;Doe&quot; }]
 } 
</pre></div><p> In this example, the object representing a family is itself composed of objects representing persons. If you want to create a "Family" Objective-C class to represent such object, you can implement it this way: </p>
<div class="fragment"><pre class="fragment"> <span class="keyword">@interface </span>Family : NSObject {
   Person* father;
   Person* mother;
   NSArray* children;
 }
 @property(nonatomic, retain) Person* father;
 @property(nonatomic, retain) Person* mother;
 @property(nonatomic, retain) NSArray* children;
 -(<span class="keywordtype">id</span>)initWithJson:(NSDictionary*)json;
 @end
</pre></div> <div class="fragment"><pre class="fragment"> <span class="keyword">@implementation </span>Family
 <span class="keyword">@synthesize</span> father, mother, children;
 -(id)initWithJson:(NSDictionary*)json {
   <span class="keywordflow">if</span> (<span class="keyword">self</span> = [super init]) {
     <span class="keyword">self</span>.father = [[[Person alloc] initWithson:[json objectForKey:@&quot;father&quot;]] autorelease];
     <span class="keyword">self</span>.mother = [[[Person alloc] initWithson:[json objectForKey:@&quot;mother&quot;]] autorelease];
     <span class="keyword">self</span>.children = [[[NSArray alloc] initWithson:[json objectForKey:@&quot;children&quot;] itemsClass:[Person class]] autorelease];
   }
   <span class="keywordflow">return</span> <span class="keyword">self</span>;
 }
 -(void)dealloc {
   [father release];
   [mother release];
   [children release];
   [<span class="keyword">super</span> dealloc];
 }
 <span class="keyword">@end</span>
</pre></div> </div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Sat May 29 00:10:58 2010 for JSONRPC Framework by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
